<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vercel Pro Suite - All in One</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.11/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.11/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.11/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.11/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #050505; color: #fff; min-height: 100vh; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .aurora { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(circle at 50% -20%, #1a1a2e, #050505); }
        .CodeMirror { height: 350px; border-radius: 12px; font-size: 14px; border: 1px solid rgba(255,255,255,0.1); }
        .loading-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .tab-active { border-bottom: 2px solid #3b82f6; color: #3b82f6; }
    </style>
</head>
<body class="pb-20">
    <div class="aurora"></div>

    <nav class="border-b border-white/10 py-4 px-6 mb-8 glass sticky top-0 z-50">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold flex items-center gap-2">
                <i class="fa-solid fa-cloud-arrow-up text-blue-500"></i> DevJoy Vercel
            </h1>
            <div class="flex gap-6 text-sm font-medium text-gray-400">
                <button onclick="switchTab('deploy')" id="tab-deploy" class="pb-1 tab-active transition-all">Deploy</button>
                <button onclick="switchTab('history')" id="tab-history" class="pb-1 transition-all">Project List</button>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-4">
        
        <div id="section-deploy" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="glass rounded-3xl p-8 space-y-6 shadow-2xl">
                <div class="flex justify-between items-center">
                    <h2 class="text-xs font-bold uppercase tracking-widest text-gray-400">Konfigurasi Deploy</h2>
                    <span class="text-[10px] bg-blue-500/20 text-blue-400 px-2 py-0.5 rounded-full uppercase">Production</span>
                </div>
                
                <div class="space-y-4">
                    <div class="relative">
                        <i class="fa-solid fa-key absolute left-4 top-4 text-gray-500 text-xs"></i>
                        <input type="password" id="token" class="w-full bg-white/5 border border-white/10 rounded-xl pl-10 pr-4 py-3 text-sm focus:border-blue-500 outline-none transition" placeholder="Vercel API Token (pfx_...)">
                    </div>

                    <div class="relative">
                        <i class="fa-solid fa-globe absolute left-4 top-4 text-gray-500 text-xs"></i>
                        <input type="text" id="projectName" class="w-full bg-white/5 border border-white/10 rounded-xl pl-10 pr-4 py-3 text-sm focus:border-blue-500 outline-none transition" placeholder="Nama Project (misal: web-ku)">
                    </div>

                    <div class="p-4 bg-white/5 rounded-xl border border-white/10 flex items-center gap-4">
                        <input type="file" id="fileInput" accept=".html,.zip" class="block w-full text-xs text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-bold file:bg-white file:text-black cursor-pointer">
                    </div>

                    <div id="editorContainer" class="hidden">
                        <div class="flex justify-between items-center mb-2">
                            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Live Editor (Preview index.html)</p>
                            <span class="text-[10px] text-yellow-500">Auto-saved to deployment</span>
                        </div>
                        <textarea id="codeEditor"></textarea>
                    </div>

                    <button id="deployBtn" onclick="mulaiDeploy()" class="w-full bg-white text-black py-4 rounded-xl font-bold uppercase hover:bg-blue-600 hover:text-white transition-all active:scale-95 flex items-center justify-center gap-3 shadow-lg">
                        <span>Deploy Sekarang</span> <i class="fa-solid fa-paper-plane"></i>
                    </button>
                </div>
            </div>

            <div class="flex flex-col justify-center space-y-6 px-4">
                <div class="glass p-6 rounded-2xl border-l-4 border-blue-500">
                    <h4 class="font-bold text-sm mb-2"><i class="fa-solid fa-circle-info mr-2"></i> Tips Domain</h4>
                    <p class="text-xs text-gray-400 leading-relaxed">Gunakan nama unik untuk mendapatkan domain <span class="text-white font-mono">nama-project.vercel.app</span>. Jika nama sudah diambil, Vercel akan menambah akhiran unik.</p>
                </div>
                <div class="glass p-6 rounded-2xl border-l-4 border-purple-500">
                    <h4 class="font-bold text-sm mb-2"><i class="fa-solid fa-box-archive mr-2"></i> Support Multi-File</h4>
                    <p class="text-xs text-gray-400 leading-relaxed">Unggah file <span class="text-white font-mono">.zip</span> untuk menyertakan CSS, JS, dan Gambar sekaligus dalam satu folder root.</p>
                </div>
            </div>
        </div>

        <div id="section-history" class="hidden">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-xl font-bold italic">Manage Your Projects</h2>
                <button onclick="clearAllHistory()" class="text-[10px] text-red-500 font-bold border border-red-500/30 px-3 py-1 rounded-full hover:bg-red-500 hover:text-white transition">HAPUS LOCAL HISTORY</button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="historyGrid">
                </div>
        </div>

    </main>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 glass px-8 py-4 rounded-2xl hidden items-center gap-4 border-white/20 shadow-[0_20px_50px_rgba(0,0,0,0.5)] z-[100]">
        <i class="fa-solid fa-circle-notch loading-spin text-blue-500 text-xl"></i>
        <div>
            <p id="toastText" class="text-sm font-bold">Memproses...</p>
            <p class="text-[10px] text-gray-500">Harap jangan tutup tab ini</p>
        </div>
    </div>

    <script>
        let editor;
        let historyData = JSON.parse(localStorage.getItem('vercel_suite_v2_history')) || [];

        // Inisialisasi
        window.onload = () => {
            editor = CodeMirror.fromTextArea(document.getElementById("codeEditor"), {
                mode: "xml",
                theme: "dracula",
                lineNumbers: true,
                autoCloseTags: true
            });
            renderHistory();
        };

        // File Handler
        document.getElementById('fileInput').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file && file.name.endsWith('.html')) {
                const text = await file.text();
                document.getElementById('editorContainer').classList.remove('hidden');
                editor.setValue(text);
                editor.refresh();
            } else {
                document.getElementById('editorContainer').classList.add('hidden');
            }
        });

        function switchTab(tab) {
            document.getElementById('section-deploy').classList.toggle('hidden', tab !== 'deploy');
            document.getElementById('section-history').classList.toggle('hidden', tab !== 'history');
            document.getElementById('tab-deploy').className = tab === 'deploy' ? 'pb-1 tab-active' : 'pb-1';
            document.getElementById('tab-history').className = tab === 'history' ? 'pb-1 tab-active' : 'pb-1';
        }

        async function mulaiDeploy() {
            const token = document.getElementById('token').value.trim();
            const projectName = document.getElementById('projectName').value.trim().toLowerCase().replace(/\s+/g, '-');
            const fileInput = document.getElementById('fileInput');
            const btn = document.getElementById('deployBtn');

            if(!token || !projectName || !fileInput.files[0]) {
                alert("Wajib: Token, Nama Project, dan File!");
                return;
            }

            showToast("ðŸ“¦ Mengemas Berkas...");
            btn.disabled = true;

            try {
                let filesToDeploy = [];
                const file = fileInput.files[0];

                if (file.name.endsWith('.zip')) {
                    const zip = await JSZip.loadAsync(file);
                    for (const [filename, fileObj] of Object.entries(zip.files)) {
                        if (!fileObj.dir) {
                            const content = await fileObj.async("string");
                            filesToDeploy.push({ file: filename, data: content });
                        }
                    }
                } else {
                    const content = editor.getValue() || await file.text();
                    filesToDeploy.push({ file: "index.html", data: content });
                }

                showToast("ðŸš€ Mengunggah ke Server Vercel...");
                const response = await fetch('https://api.vercel.com/v13/deployments', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: projectName,
                        files: filesToDeploy,
                        projectSettings: { framework: null },
                        target: 'production'
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    showToast("â³ Sinkronisasi Domain...");
                    // Simpan ke local history
                    saveHistory(projectName, result.id, token, `https://${projectName}.vercel.app`);
                    
                    setTimeout(() => {
                        hideToast();
                        switchTab('history');
                    }, 2500);
                } else {
                    throw new Error(result.error.message);
                }
            } catch (e) {
                alert("Error: " + e.message);
                hideToast();
            } finally {
                btn.disabled = false;
            }
        }

        async function checkStatus(id, token, elementId) {
            const el = document.getElementById(elementId);
            try {
                const res = await fetch(`https://api.vercel.com/v13/deployments/${id}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();
                const status = data.readyState; // READY, BUILDING, ERROR
                
                el.innerText = status;
                el.className = `text-[9px] px-2 py-0.5 rounded-full font-bold ${
                    status === 'READY' ? 'bg-green-500/20 text-green-400' : 
                    status === 'ERROR' ? 'bg-red-500/20 text-red-400' : 'bg-yellow-500/20 text-yellow-400 animate-pulse'
                }`;
            } catch { el.innerText = "UNKNOWN"; }
        }

        async function deleteProject(id, token, name) {
            if(!confirm(`Hapus deployment ${name}?`)) return;
            showToast("ðŸ—‘ï¸ Menghapus dari Vercel...");
            try {
                const res = await fetch(`https://api.vercel.com/v13/deployments/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if(res.ok) {
                    historyData = historyData.filter(item => item.id !== id);
                    localStorage.setItem('vercel_suite_v2_history', JSON.stringify(historyData));
                    renderHistory();
                }
            } catch (e) { alert("Gagal menghapus"); }
            hideToast();
        }

        function saveHistory(name, id, token, url) {
            historyData.unshift({ name, id, token, url, date: new Date().toLocaleString() });
            localStorage.setItem('vercel_suite_v2_history', JSON.stringify(historyData));
            renderHistory();
        }

        function renderHistory() {
            const grid = document.getElementById('historyGrid');
            if (historyData.length === 0) {
                grid.innerHTML = `<div class="col-span-full py-20 text-center opacity-20"><i class="fa-solid fa-folder-open text-6xl mb-4"></i><p>Belum ada riwayat deployment</p></div>`;
                return;
            }
            grid.innerHTML = historyData.map((item, i) => `
                <div class="glass p-6 rounded-3xl hover:border-white/30 transition-all group">
                    <div class="flex justify-between items-start mb-6">
                        <span id="status-${i}" class="text-[9px] bg-white/10 px-2 py-0.5 rounded-full tracking-tighter">CHECKING...</span>
                        <div class="flex gap-2">
                             <button onclick="checkStatus('${item.id}', '${item.token}', 'status-${i}')" class="text-gray-500 hover:text-white"><i class="fa-solid fa-rotate text-xs"></i></button>
                             <button onclick="deleteProject('${item.id}', '${item.token}', '${item.name}')" class="text-gray-500 hover:text-red-500"><i class="fa-solid fa-trash text-xs"></i></button>
                        </div>
                    </div>
                    <h3 class="font-bold text-lg mb-1 truncate">${item.name}</h3>
                    <p class="text-[10px] text-gray-500 mb-6 font-mono">${item.date}</p>
                    <a href="${item.url}" target="_blank" class="block w-full bg-white text-black text-center py-2.5 rounded-xl text-xs font-black uppercase hover:bg-blue-500 hover:text-white transition shadow-lg">Open Website</a>
                </div>
            `).join('');
            
            historyData.forEach((item, i) => checkStatus(item.id, item.token, `status-${i}`));
        }

        function clearAllHistory() {
            if(confirm("Hapus semua riwayat di browser ini? (Project di Vercel tidak akan terhapus)")) {
                historyData = [];
                localStorage.removeItem('vercel_suite_v2_history');
                renderHistory();
            }
        }

        function showToast(msg) { 
            document.getElementById('toastText').innerText = msg;
            document.getElementById('toast').style.display = 'flex'; 
        }
        function hideToast() { document.getElementById('toast').style.display = 'none'; }
    </script>
</body>
</html>
